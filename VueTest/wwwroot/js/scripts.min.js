var HubProxy,RestService,register,login,menu,chat,home;Vue.directive("align",{inserted:function(n,t){var i=t.arg.split(",");n.style.flexDirection&&(i.length>0&&(n.style.justifyContent=i[0]),i.length>1&&(n.style.alignItems=i[1]))}});Vue.directive("bottomScroll",{bind:(n,t)=>{function f(t){function o(n,t,i,r){return(n/=r/2,n<1)?i/2*n*n+t:(n-=1,-i/2*(n*(n-2)-1)+t)}function u(f){f+=r;var s=o(f,i,e,t);n.scrollTop=s;f<t&&setTimeout(function(){u(f)},r)}var i=n.scrollTop,f=n.scrollHeight,e=f-i,r=20;u(0)}function e(){r?f(i):n.scrollTop=n.scrollHeight}var i=t.value.duration||500,r=t.value.animate,u=new MutationObserver(e);u.observe(n,{childList:!0,characterData:!0})}});Vue.directive("flex",{inserted:function(n,t){n.style.display="flex";t.modifiers.flex&&(n.style.flex=1);switch(t.arg){case"row":n.style.flexDirection="row";break;case"column":n.style.flexDirection="column";break;default:n.style.flexDirection=n.parentElement.flexDirection!==""?n.parentElement.flexDirection:"column"}}});Vue.filter("formatDate",function(n,t){if(n)return moment(String(n)).format(t)});HubProxy=function(n,t,i){var r=this;this.proxyConnection=$.hubConnection();this.connectionId=null;this.proxyConnection.url=n;this.proxyConnection.qs="hardware_id="+t+"&connection_type=1";this.scope=i;this.chatProxy=this.proxyConnection.createHubProxy("notificationHub");this.chatProxy.on("broadcastMessage",function(n){r.scope.$emit("broadcastMessage",n)})};HubProxy.prototype.setScope=function(n){this.scope=n};HubProxy.prototype.startConnection=function(){var n=this;this.proxyConnection.start().done(function(){console.log("Connected to HubProxy, connection id: "+n.proxyConnection.id);n.connectionId=n.proxyConnection.id}).fail(function(){console.log("Could not connect to HubProxy");console.log(err);n.connectionId=null})};HubProxy.prototype.stopConnection=function(){console.log("Stop HubProxy connection.");this.proxyConnection.stop();this.connectionId=null};HubProxy.prototype.sendMessage=function(n,t){this.chatProxy.invoke("sendMessageToEtp",g_hardwareId,n).fail(function(n){console.log("Failed to send the mesage.");t(n);this.scope.$message({showClose:!0,message:"Oops, this is a error message.",type:"error",duration:5e3})})};HubProxy.prototype.onNewMessage=function(n,t){var i=this;(n.newMessageHandler===undefined||n.newMessageHandler===null)&&(n.newMessageHandler=i.chatProxy.on("newMessage",function(n){t(n)}),n.$on("destroy",function(){i.chatProxy.off("newMessage");n.newMessageHandler=null}))};RestService=function(n){axios.default.baseURL=g_apiBaseUrl;axios.defaults.headers.common.Authorization=n;axios.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded";this.http=axios};RestService.prototype.get=function(n){return this.http.get(axios.default.baseURL+n)};var restService=new RestService("Basic "+Base64.encode(g_hardwareId+":0101")),apiFactory={getChat:function(n){return restService.get("messageapi/getchat/"+g_hardwareId+"/"+n+"?"+(new Date).getTime())},getUserProfile:function(){return restService.get("profileapi/getprofile/"+g_hardwareId)}},Register=function(){var n=this;this.routes=[];this.router=null;this.modules=["home","chat"];this.registeredModules=[];this.moduleCount=0;this.registerTimer=setTimeout(function(){var t=[];n.registeredModules.length<n.modules.length&&(n.modules.forEach(i=>{n.registeredModules.includes(i)||t.push(i)}),console.log("Cannot find module(s) ["+t.join(", ")+"]."))},1e3)};Register.prototype.registerModule=function(n,t){this.modules.includes(n)?(this.moduleCount++,this.registeredModules.push(n),this.routes.push({path:"/"+n,component:t})):console.log("Module ["+n+"] is not registered.");this.moduleCount>=this.modules.length&&this.mountVue()};Register.prototype.mountVue=function(){var n=this.routes,t=new HubProxy(g_signalrBaseUrl,g_hardwareId),i=new Vue({data:{activeIndex:"home",profile:{},showLogin:!0},methods:{show:function(){this.visible=!0},handleSelect:function(n){this.goto(n)},goBack:function(){window.history.length>1?this.$router.go(-1):this.$router.push("/")},goto:function(n){this.$router.push(n);this.activeIndex=n}},beforeCreate:function(){var n=this;n.hubProxy=t;n.hubProxy.setScope(n);n.hubProxy.startConnection();apiFactory.getUserProfile().then(function(t){n.profile=t.data}).catch(function(n){console.log(n)})},mounted:function(){var t=this,n=t.$route.path;n!==undefined&&n!=="/"&&n!==""&&n!==null?(t.goto(n),t.activeIndex=n.match(/[^\/]+/g)[0].match(/[^\?]+/g)[0]):t.goto("home")},router:new VueRouter({routes:function(){return n.forEach(n=>{n.props={hubProxy:t}}),n}()})}).$mount("#app")};Register.prototype.getTemplate=function(n,t){$.get(n,function(n){t(n)},"html")};register=new Register;login={methods:{setLoginWindow:function(){},login:function(){console.log(this.loginForm)},forgetPassword:function(){console.log("forget password")}},data:function(){return{loginForm:{account:"",password:""}}},mounted:function(){}};register.getTemplate("../vuetest/component/login.html",function(n){login.template=n;Vue.component("login",login)});menu={props:["menuIndex"],methods:{handleSelect:function(n){this.showMenu=!1;this.$parent.goto(n)},setMenu:function(){window.innerWidth<600?this.menuMode="vertical":(this.menuMode="horizontal",this.showMenu=!1)}},data:function(){return{showMenu:!1,menuMode:"horizontal"}},mounted:function(){window.addEventListener("resize",this.setMenu);this.setMenu()}};register.getTemplate("../vuetest/component/menu.html",function(n){menu.template=n;Vue.component("main-menu",menu)});chat={props:["hubProxy","profile"],methods:{send:function(){var n={name:this.profile.fName+" "+this.profile.lName,message:this.message,create_Dt:new Date,isMe:!0,type:"text"};this.message!==""&&this.message!==null&&(this.hubProxy.sendMessage(n),this.conversations[this.conversations.length-1].chats.push(n),this.message=null,this.$refs.message.focus());setTimeout(()=>{this.scrollBottom(this.$refs.chatbox)},100)},scrollBottom:function(n){n.scrollTop=n.scrollHeight},onresize:function(){this.scrollBottom(this.$refs.chatbox)},enterPress:function(){this.send()}},data:function(){return{message:"",conversations:[],loading:!1}},created:function(){var n=this;n.convId=-1;n.loadChats=function(){n.loading=!0;apiFactory.getChat(n.convId).then(function(t){var i=t.data;n.convId=i.convId;n.conversations.splice(0,0,i);i.chats.forEach(n=>{n.isMe=n.user_Id==="00000000-0000-0000-0000-000000000000"});n.loading=!1}).catch(function(t){console.log("Could not get chats.");console.log(t);n.loading=!1})};n.registerEvent=function(){n.hubProxy.onNewMessage(n,function(t){t.isMe=!1;t.create_Dt=new Date;n.conversations[n.conversations.length-1].chats.push(t);setTimeout(()=>{n.scrollBottom(n.$refs.chatbox)},100)})},function(){n.loadChats();n.registerEvent()}()},mounted:function(){window.addEventListener("resize",this.onresize)},beforeDestroy:function(){window.removeEventListener("resize",this.onresize)},destroyed:function(){this.$emit("destroy")}};register.getTemplate("../vuetest/component/chat.html",function(n){chat.template=n;register.registerModule("chat",chat)});home={methods:{greet:function(){alert("worked")}}};register.getTemplate("../vuetest/component/home.html",function(n){home.template=n;register.registerModule("home",home)});